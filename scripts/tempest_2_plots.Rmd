---
title: "figures"
author: "AMP"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
getwd()
```

```{r event and study dates}
endstudydate = lubridate::as_date("2024-01-31")
startstudydate = lubridate::as_date("2022-05-01")

WaterDeliveryStart2022 = as.POSIXct("2022-06-22 05:30:00", tz = "EST")
WaterDeliveryStop2022 = as.POSIXct("2022-06-22 14:30:00", tz = "EST")

WaterDeliveryStart1 = as.POSIXct("2023-06-06 05:30:00", tz = "EST")
WaterDeliveryStop1 = as.POSIXct("2023-06-06 14:30:00", tz = "EST")

WaterDeliveryStart2 = as.POSIXct("2023-06-07 05:30:00", tz = "EST")
WaterDeliveryStop2 = as.POSIXct("2023-06-07 14:30:00", tz = "EST")
```

```{r load data}
pw_grids <- readRDS("./processed data/TMP_PW_GRIDSONLY_NPOC_TDN_L1_May2022-Dec2023.rds")

pw_pooled <- readRDS("./processed data/TMP_PW_POOL_NPOC_TDN_L1_May2022-Dec2023.rds")

eems_pooled <- readRDS("./processed data/TMP_PW_POOLED_CDOM_L1_May2022-Dec2023.rds")
eems_grids <- readRDS("./processed data/TMP_PW_grids_CDOM_L1_May2022-Dec2023.rds")

```

all_the_doc <- pw2022event %>%
  full_join(pw2022) %>%
  full_join(pw2023) %>%
  mutate(date = as.POSIXct(date)) %>%
  mutate(Plot = stringr::str_replace(Plot,"SW","Estuarine-water Plot")) %>%
  mutate(Plot = stringr::str_replace(Plot,"FW","Freshwater Plot")) %>%
  mutate(Plot = stringr::str_replace(Plot,"C","Control Plot")) %>%
  mutate(date_formatted = paste0(lubridate::year(date), "-", lubridate::month(date), "-", lubridate::day(date))) %>%
  mutate(date_formatted = lubridate::as_date(date_formatted)) %>%
  mutate(plot_date = case_when( lubridate::month(date_formatted) == lubridate::month(event_2023) ~ paste0(lubridate::year(date), "-", lubridate::month(date), "-", lubridate::day(date)),
                               lubridate::month(date_formatted) == lubridate::month(event_2023) ~ paste0(lubridate::year(date), "-", lubridate::month(date), "-", lubridate::day(date)),
          TRUE ~  paste0(lubridate::year(date), "-", lubridate::month(date), "-", "01")),
        month = lubridate::month(date),
        year = lubridate::year(date)) %>%
  mutate(plot_date = lubridate::with_tz(plot_date, "UTC")) %>%
  group_by(Plot, plot_date, month, year) %>% 
  filter(Grid != "POOL") %>%
  filter(!npoc_flag %in% "omitted for high dilution and blank values") %>%
  filter(!tdn_flag %in% "omitted for high dilution and blank values") %>%
  filter(!sample_name %in% "Lysimeter Empty") %>%
  summarise(n=n(),
              doc_mg_l_sd = round(sd(doc_mg_l, na.rm = TRUE), 2),
            doc_mg_l = round(mean(doc_mg_l, na.rm = TRUE), 2),
            tdn_mg_l_sd = round(sd(tdn_mg_l, na.rm = TRUE), 2),
            tdn_mg_l = round(mean(tdn_mg_l, na.rm = TRUE),2),
            .groups = "drop") %>%
    arrange(Plot, year, month)

all_eems <- eems %>%
   mutate(date = as.POSIXct(date)) %>%
  mutate(Plot = stringr::str_replace(Plot,"SW","Estuarine-water Plot")) %>%
  mutate(Plot = stringr::str_replace(Plot,"FW","Freshwater Plot")) %>%
  mutate(Plot = stringr::str_replace(Plot,"C","Control Plot")) %>%
  mutate(date_formatted = paste0(lubridate::year(date), "-", lubridate::month(date), "-", lubridate::day(date))) %>%
  mutate(date_formatted = lubridate::as_date(date_formatted)) %>%
  mutate(plot_date = case_when( lubridate::month(date_formatted) == lubridate::month(event_2023) ~ paste0(lubridate::year(date), "-", lubridate::month(date), "-", lubridate::day(date)),
                               lubridate::month(date_formatted) == lubridate::month(event_2023) ~ paste0(lubridate::year(date), "-", lubridate::month(date), "-", lubridate::day(date)),
          TRUE ~  paste0(lubridate::year(date), "-", lubridate::month(date), "-", "01")),
        month = lubridate::month(date),
        year = lubridate::year(date)) %>%
  mutate(plot_date = lubridate::with_tz(plot_date, "UTC")) %>%
  group_by(Plot, plot_date, month, year) %>% 
    arrange(Plot, year, month)
    
# Plotting

Figure X for Take Home Message: There is a prolonged and sustained release of carbon following exposure to salinity.

```{r DOC plot through time}
plot_order <- c('Control Plot', 'Freshwater Plot','Estuarine-water Plot')
Anyas_colors_alpha_order = c("springgreen2", "violetred2", "cyan2")

```
